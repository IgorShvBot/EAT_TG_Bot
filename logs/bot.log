02-05-2025 10:34:57 - telegram.ext.Application - INFO - Application started
02-05-2025 10:40:35 - root - INFO - Запуск бота в Docker-контейнере
02-05-2025 10:40:36 - telegram.ext.Application - INFO - Application started
02-05-2025 10:41:09 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 10:41:09 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 10:41:09 - root - INFO - Используются настройки: return_files=0
02-05-2025 10:41:10 - camelot - INFO - Processing page-1
02-05-2025 10:41:10 - camelot - INFO - Processing page-2
02-05-2025 10:41:11 - camelot - INFO - Processing page-3
02-05-2025 10:41:11 - camelot - INFO - Processing page-4
02-05-2025 10:41:11 - camelot - INFO - Processing page-5
02-05-2025 10:41:11 - camelot - INFO - Processing page-6
02-05-2025 10:41:11 - camelot - INFO - Processing page-7
02-05-2025 10:41:11 - camelot - INFO - Processing page-8
02-05-2025 10:41:12 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 10:41:12 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 10:41:12 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 10:41:16 - root - INFO - Удален временный файл: /tmp/tmptg2i04ji.pdf
02-05-2025 10:41:16 - root - INFO - Удален временный файл: /tmp/transactions_Tinkoff_Platinum_temp.csv
02-05-2025 10:41:16 - root - INFO - Удален временный файл: /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 10:41:16 - root - INFO - Удален временный файл: /tmp/result.csv
02-05-2025 10:41:16 - root - INFO - Удален временный файл: /tmp/unclassified.csv
02-05-2025 10:49:27 - root - INFO - Запуск бота в Docker-контейнере
02-05-2025 10:49:28 - telegram.ext.Application - INFO - Application started
02-05-2025 10:49:55 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 10:49:55 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 10:49:55 - root - INFO - Используются настройки: return_files=0
02-05-2025 10:49:56 - camelot - INFO - Processing page-1
02-05-2025 10:49:56 - camelot - INFO - Processing page-2
02-05-2025 10:49:57 - camelot - INFO - Processing page-3
02-05-2025 10:49:57 - camelot - INFO - Processing page-4
02-05-2025 10:49:57 - camelot - INFO - Processing page-5
02-05-2025 10:49:57 - camelot - INFO - Processing page-6
02-05-2025 10:49:57 - camelot - INFO - Processing page-7
02-05-2025 10:49:57 - camelot - INFO - Processing page-8
02-05-2025 10:49:58 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 10:49:58 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 10:49:58 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 10:50:19 - root - INFO - Удален временный файл: /tmp/tmphis1xghk.pdf
02-05-2025 10:50:19 - root - INFO - Удален временный файл: /tmp/transactions_Tinkoff_Platinum_temp.csv
02-05-2025 10:50:19 - root - INFO - Удален временный файл: /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 10:50:19 - root - INFO - Удален временный файл: /tmp/result.csv
02-05-2025 10:50:19 - root - INFO - Удален временный файл: /tmp/unclassified.csv
02-05-2025 10:50:38 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 10:50:38 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 10:50:38 - root - INFO - Используются настройки: return_files=0
02-05-2025 10:50:39 - camelot - INFO - Processing page-1
02-05-2025 10:50:39 - camelot - INFO - Processing page-2
02-05-2025 10:50:40 - camelot - INFO - Processing page-3
02-05-2025 10:50:40 - camelot - INFO - Processing page-4
02-05-2025 10:50:40 - camelot - INFO - Processing page-5
02-05-2025 10:50:40 - camelot - INFO - Processing page-6
02-05-2025 10:50:40 - camelot - INFO - Processing page-7
02-05-2025 10:50:41 - camelot - INFO - Processing page-8
02-05-2025 10:50:41 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 10:50:41 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 10:50:41 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 10:50:52 - database - ERROR - Ошибка подключения к БД: connection to server at "localhost" (::1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

02-05-2025 10:50:52 - root - ERROR - Ошибка БД: connection to server at "localhost" (::1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
	Is the server running on that host and accepting TCP/IP connections?

02-05-2025 10:50:52 - root - ERROR - Исключение при обработке запроса:
Traceback (most recent call last):
  File "/root/.local/lib/python3.10/site-packages/telegram/ext/_application.py", line 1124, in process_update
    await coroutine
  File "/root/.local/lib/python3.10/site-packages/telegram/ext/_handler.py", line 141, in handle_update
    return await self.callback(update, context)
  File "/app/bot.py", line 102, in wrapper
    return await func(*args, **kwargs)
  File "/app/bot.py", line 1359, in handle_save_confirmation
    db.close()
UnboundLocalError: local variable 'db' referenced before assignment
02-05-2025 11:30:30 - root - INFO - Запуск бота в Docker-контейнере
02-05-2025 11:30:30 - telegram.ext.Application - INFO - Application started
02-05-2025 11:31:57 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 11:31:57 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 11:31:57 - root - INFO - Используются настройки: return_files=0
02-05-2025 11:31:58 - camelot - INFO - Processing page-1
02-05-2025 11:31:58 - camelot - INFO - Processing page-2
02-05-2025 11:31:58 - camelot - INFO - Processing page-3
02-05-2025 11:31:59 - camelot - INFO - Processing page-4
02-05-2025 11:31:59 - camelot - INFO - Processing page-5
02-05-2025 11:31:59 - camelot - INFO - Processing page-6
02-05-2025 11:31:59 - camelot - INFO - Processing page-7
02-05-2025 11:31:59 - camelot - INFO - Processing page-8
02-05-2025 11:31:59 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 11:31:59 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 11:31:59 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:32:09 - database - INFO - Попытка подключения к БД: host=host.docker.internal, dbname=finance_bot
02-05-2025 11:32:09 - database - INFO - Подключение к БД успешно
02-05-2025 11:32:09 - database - INFO - Выполнен SQL-скрипт: /app/sql/tables.sql
02-05-2025 11:32:09 - database - INFO - Выполнен SQL-скрипт: /app/sql/indexes.sql
02-05-2025 11:32:09 - database - INFO - Начало сохранения 173 транзакций для user_id=198451926
02-05-2025 11:32:09 - database - INFO - Сохранено 167 транзакций (import_id=1)
02-05-2025 11:32:09 - database - INFO - Соединение с БД закрыто
02-05-2025 11:32:09 - root - INFO - Удален временный файл: /tmp/tmpw__5v6lr.pdf
02-05-2025 11:32:09 - root - INFO - Удален временный файл: /tmp/transactions_Tinkoff_Platinum_temp.csv
02-05-2025 11:32:09 - root - INFO - Удален временный файл: /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:32:09 - root - INFO - Удален временный файл: /tmp/result.csv
02-05-2025 11:32:09 - root - INFO - Удален временный файл: /tmp/unclassified.csv
02-05-2025 11:34:25 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 11:34:26 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 11:34:26 - root - INFO - Используются настройки: return_files=0
02-05-2025 11:34:27 - camelot - INFO - Processing page-1
02-05-2025 11:34:27 - camelot - INFO - Processing page-2
02-05-2025 11:34:27 - camelot - INFO - Processing page-3
02-05-2025 11:34:27 - camelot - INFO - Processing page-4
02-05-2025 11:34:27 - camelot - INFO - Processing page-5
02-05-2025 11:34:27 - camelot - INFO - Processing page-6
02-05-2025 11:34:28 - camelot - INFO - Processing page-7
02-05-2025 11:34:28 - camelot - INFO - Processing page-8
02-05-2025 11:34:28 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 11:34:28 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 11:34:28 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:34:55 - database - INFO - Попытка подключения к БД: host=host.docker.internal, dbname=finance_bot
02-05-2025 11:34:55 - database - INFO - Подключение к БД успешно
02-05-2025 11:34:55 - database - INFO - Выполнен SQL-скрипт: /app/sql/tables.sql
02-05-2025 11:34:55 - database - INFO - Выполнен SQL-скрипт: /app/sql/indexes.sql
02-05-2025 11:34:55 - database - INFO - Начало сохранения 173 транзакций для user_id=198451926
02-05-2025 11:34:55 - database - INFO - Сохранено 167 транзакций (import_id=2)
02-05-2025 11:34:55 - database - INFO - Соединение с БД закрыто
02-05-2025 11:34:55 - root - INFO - Удален временный файл: /tmp/tmp5gfbnotj.pdf
02-05-2025 11:34:55 - root - INFO - Удален временный файл: /tmp/transactions_Tinkoff_Platinum_temp.csv
02-05-2025 11:34:55 - root - INFO - Удален временный файл: /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:34:55 - root - INFO - Удален временный файл: /tmp/result.csv
02-05-2025 11:34:55 - root - INFO - Удален временный файл: /tmp/unclassified.csv
02-05-2025 11:47:53 - root - INFO - Получен файл: Справка_о_движении_денежных_средств.pdf
02-05-2025 11:47:53 - root - INFO - Начата обработка PDF: Справка_о_движении_денежных_средств.pdf, размер: 118274 байт
02-05-2025 11:47:53 - root - INFO - Используются настройки: return_files=0
02-05-2025 11:47:54 - camelot - INFO - Processing page-1
02-05-2025 11:47:55 - camelot - INFO - Processing page-2
02-05-2025 11:47:55 - camelot - INFO - Processing page-3
02-05-2025 11:47:55 - camelot - INFO - Processing page-4
02-05-2025 11:47:55 - camelot - INFO - Processing page-5
02-05-2025 11:47:55 - camelot - INFO - Processing page-6
02-05-2025 11:47:56 - camelot - INFO - Processing page-7
02-05-2025 11:47:56 - camelot - INFO - Processing page-8
02-05-2025 11:47:56 - extract_transactions_pdf2 - INFO - Обработка CSV как Tinkoff_Platinum
02-05-2025 11:47:56 - extract_transactions_pdf2 - INFO - Успешно загружен CSV для Tinkoff Platinum, строк: 414
02-05-2025 11:47:56 - extract_transactions_pdf2 - INFO - Данные сохранены в /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:47:59 - root - INFO - Удален временный файл: /tmp/tmp0zbrpgn5.pdf
02-05-2025 11:47:59 - root - INFO - Удален временный файл: /tmp/transactions_Tinkoff_Platinum_temp.csv
02-05-2025 11:47:59 - root - INFO - Удален временный файл: /tmp/transactions_processed_tinkoff_platinum.csv
02-05-2025 11:47:59 - root - INFO - Удален временный файл: /tmp/result.csv
